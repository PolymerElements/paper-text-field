<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">

<script>
  /**
   * Use `Polymer.PaperContentEditableBehavior` to patch a <div contenteditable>
   * element to act like a plain <input>

   * @polymerBehavior Polymer.PaperContentEditableBehavior
   */
  Polymer.PaperContentEditableBehaviorImpl = {
    _setUpListeners: function() {
      this.inputElement.addEventListener('paste', this._onPaste.bind(this));
      this.inputElement.addEventListener('input', this._onInput.bind(this));
      this.inputElement.addEventListener('keydown', this._preventRichTextFormatting.bind(this));

      // Never stop being different, IE.
      this.inputElement.addEventListener('textinput', this._onInput.bind(this));
    },

    /**
     * Called after a paste event inside the input element.
     */
    _onPaste: function(event) {
      var pastedText = undefined;
      if (window.clipboardData && window.clipboardData.getData) { // IE
        pastedText = window.clipboardData.getData('Text');
      } else if (event.clipboardData && event.clipboardData.getData) {
        pastedText = event.clipboardData.getData('text/plain');
      }
      // Allow the pasted text and update the labels.
      document.execCommand('insertText', true, pastedText);
      this._onInput();
      event.preventDefault();
    },

    /**
     * Called on keydown, to prevent rich formatting of the input.
     */
    _preventRichTextFormatting: function(event) {
      // Prevent Ctrl+B and Ctrl+I for bolding and italics.
      if (!event.ctrlKey && !event.metaKey)
        return;

      if (event.keyCode === 66 /* b */ || event.keyCode === 73 /* i */) {
        event.preventDefault();
      }
    }
  };

  Polymer.PaperContentEditableBehavior = [Polymer.PaperContentEditableBehaviorImpl];
</script>
